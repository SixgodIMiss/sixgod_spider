{% include "header.html" %}
<style type="text/css">
    .basic-info, .data-log {
        padding: 10px;
        overflow: hidden;
    }
    .basic-panel {
        width: 40%;
    }
    .basic-pic {
        width: 59%;
        height: 368px;
    }
    .list-group-item {
        padding: 6px;
    }
    .progress {
        height: 12px;
    }
    #timeline {
        width: 100%;
        height: 350px;
    }
    .well {
        padding: 2px;
    }
</style>

<div class="center">
    {% include "nav.html" %}
    <div class="main">
        <a href="javascript:history.go(-1);" class="back">返回上一步</a>
        <h3>爬取结果展示</h3>
        <div class="basic-info">
            <div class="pull-left basic-panel">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <h4><strong>基本信息</strong></h4>
                    </div>
                    <div class="panel-body">
                        <ul class="list-group">
                            <li class="list-group-item">
                                <label>应用：</label>
                                <span>666</span>
                            </li>
                            <li class="list-group-item">
                                <label>运行状态：</label>
                                <span>stop</span>
                            </li>
                            <li class="list-group-item">
                                <label>上一次启动时间：</label>
                                <span>0</span>
                            </li>
                            <li class="list-group-item">
                                <label>上一次结束：</label>
                                <span>0</span>
                            </li>
                            <li class="list-group-item">
                                <label>上一次爬取数据：</label>
                                <span>0</span>条
                            </li>
                            <li class="list-group-item">
                                <label>当前爬取进度：</label>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100" style="width: 60%;">
                                        <span class="sr-only">60% Complete</span>
                                    </div>
                                </div>
                            </li>
                        </ul>
                    </div>
                </div>
            </div>
            <div class="pull-right basic-pic well">
                <div id="timeline"></div>
            </div>
        </div>
        <div class="data-log">
            <div class="panel panel-default">
                <!-- Default panel contents -->
                <div class="panel-heading">数据</div>

                <!-- Table -->
                <table id="data-list" grid-manager="data-list"></table>
            </div>
            <div class="panel panel-default">
                <div class="panel-heading">日志</div>

                <table id="log-list" grid-manager="log-list"></table>
            </div>
        </div>
    </div>
</div>
{% include "footer.html" %}

<script type="text/javascript">
    // 最近的10个时间节点 间隔两秒
    var getTen = function (now = new Date()) {
        var ten = [];
        var i = 0;
        while (++i) {
            if (10 < i) {
                break;
            }
            var time = new Date(now.getTime()-i*2000);
            ten.push(time.format('h:mm:ss'));
        }
        return ten.sort();
    };

    $(document).ready(function () {
        var timeline = echarts.init(document.getElementById('timeline'));
        var data = range(0, 10, 10);
        var options = {
            title: {
                text: '数据爬取时间轴',
                top: 20,
                left: 20
            },
            grid: {
                top: 80
            },
            tooltip : {
                trigger: 'axis'
            },
            xAxis: {
                type: 'category',
                name: '时间轴/每间隔2s',
                nameLocation: 'middle',
                nameTextStyle: {
                    fontStyle: 'italic',
                    padding: [10, 0]
                },
                axisLine: {
                    show: true
                },
                boundaryGap: false,
                data: getTen()
            },
            yAxis: {
                type: 'value'
            },
            series: {
                data: data,
                type: 'line',
                animation: true,
                animationDuration: 200,
                animationEasing: function (k) {
                    return k === 1 ? 1 : 1 - Math.pow(2, -10 * k);
                }
            }
        };
        timeline.setOption(options);
        setInterval(function () {
            options.xAxis.data = getTen();
            data.shift();
            data.push(range(0, 10, 1)[0]);
            options.series.data = data;
            timeline.setOption(options);
        }, 2000);

        var data_table = $('#data-list');
        data_table.GM({
            height: '300px'
            ,pageSize: 20
            ,ajax_data: "{% url 'crawlerList' %}"
            ,ajax_type: 'POST'
            ,query: {pluginId: 1}
            ,supportAjaxPage: true
            ,supportMenu: false
            ,columnData: [
                {
                    key: 'name',
                    text: '名称',
                    width: '25%',
                },
                {
                    key: 'company',
                    text: '公司',
                    width: '20%',
                },
                {
                    key: 'project_date',
                    text: '日期',
                    width: '10%',
                    align: 'center',
                },
                {
                    key: 'price',
                    text: '金额',
                    width: '8%',
                    align: 'center',
                },
                {
                    key: 'architecter',
                    text: '建造师',
                    align: 'center',
                    width: '10%'
                },
                {
                    key: '源网址',
                    text: 'url'
                }
            ]
        });
        var log_table = $('#log-list');
        log_table.GM({
            height: '300px'
            ,pageSize: 20
            ,ajax_data: "{% url 'crawlerList' %}"
            ,ajax_type: 'POST'
            ,query: {pluginId: 1}
            ,supportAjaxPage: true
            ,supportMenu: false
            ,columnData: [
                {
                    key: 'name',
                    text: '名称',
                    width: '25%',
                    template: function (nodeData, rowData) {
                        return '<a href="'+'{% url "crawlerData" %}'+'?&id='+rowData.id+'" title="查看数据" style="margin-left: 5px; font-size: 16px">'+rowData.name+'</a>';
                    }
                },
                {
                    key: 'config',
                    text: '配置',
                    width: '5%',
                    align: 'center',
                    template: function (nodeData, rowData) {
                        return '<a href="'+'{% url "crawlerInfo" %}'+'?&id='+rowData.id+'" title="查看详情">详情</a>';
                    }
                },
                {
                    key: 'status',
                    text: '状态',
                    width: '5%',
                    align: 'center',
                    template: function (nodeData, rowData) {
                        return '<span style="margin-left: 5px; color: #999;">'+rowData.status+'</span>';
                    }
                },
                {
                    key: 'area',
                    text: '地区',
                    width: '15%',
                    align: 'center',
                    template: function (nodeData, rowData) {
                        return '<span style="margin-left: 5px;">'+rowData.province+'-'+rowData.city+'</span>';
                    }
                },
                {
                    key: 'user',
                    text: '创建者',
                    align: 'center',
                    width: '10%'
                },
                {
                    key: 'create_time',
                    text: '创建时间',
                    align: 'center',
                    width: '15%'
                }
            ]
        });
    });

</script>